<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Chat Point | Food Shops</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icon-192.png" type="image/png" />
  <meta name="theme-color" content="#FFD700" />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    :root{
      --bg: #fffaf2; 
      --card: #ffffff; 
      --text: #111111; 
      --muted: #6b6b6b;
      --primary: #75d133d5;
      --accent: #036487;
      --shadow: rgba(17,17,17,0.06);
      --glass: rgba(255,255,255,0.7);
      --radius: 16px;
      --glass-border: rgba(255,165,0,0.08);
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:"Outfit",system-ui}
    html,body{height:100%}
    body{
      background: linear-gradient(180deg,var(--bg), #fff6da 120px);
      color:var(--text); min-height:100vh; overflow-x:hidden;
    }
    .floating-icons{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden}
    .float-svg{position:absolute;opacity:0.1;animation:gentleFloat 9s ease-in-out infinite}
    .float-1{left:6%;top:12%;width:88px}
    .float-2{right:6%;bottom:8%;width:110px;opacity:0.12}
    .float-3{left:50%;top:40%;width:120px;transform:translateX(-50%) rotate(-8deg)}
    .float-4{left:8%;bottom:20%;width:72px;opacity:0.08}
    @keyframes gentleFloat{
      0%,100%{transform:translateY(0) rotate(0deg)}
      50%{transform:translateY(-18px) rotate(6deg)}
    }
    header{
      position:sticky;top:0;z-index:120;display:flex;align-items:center;gap:12px;
      padding:14px 18px;background:var(--primary);box-shadow:0 6px 18px var(--shadow);
    }
    .nav-btn{width:46px;height:46px;border-radius:12px;background:rgba(255,255,255,0.6);display:grid;place-items:center;cursor:pointer}
    .brand{font-weight:800;font-size:20px;color:#111}
    .brand span{color:var(--accent);font-weight:900}
    .header-right{margin-left:auto}
    .cart-btn{background:var(--accent);color:white;padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer}
    .sidebar{position:fixed;left:-100%;top:0;width:320px;height:100%;z-index:220;background:linear-gradient(180deg,#fff,#fff9e6);padding:18px;box-shadow:6px 20px 60px rgba(0,0,0,0.12);transition:left .32s ease}
    .sidebar.active{left:0}
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,0,0.45);z-index:210;display:none}
    .overlay.active{display:block}
    main{max-width:1180px;margin:22px auto;padding:0 18px;position:relative;z-index:2}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px}
    .card{background:var(--card);border-radius:14px;overflow:hidden;cursor:pointer;transition:transform .28s,box-shadow .28s;box-shadow:0 4px 12px var(--shadow)}
    .card:hover{transform:translateY(-5px);box-shadow:0 30px 60px rgba(0,0,0,0.1)}
    .card img{width:100%;height:160px;object-fit:cover;background:#f3f3f3}
    .info{padding:12px 14px;display:flex;justify-content:space-between;align-items:center}
    .shop-name{font-weight:800;font-size:17px}
    .rating{background:linear-gradient(90deg,#fffaf0,#fff6da);padding:6px 12px;border-radius:999px;font-weight:700;display:flex;align-items:center;gap:6px}
    .desc{padding:0 14px 12px;color:var(--muted);font-size:14px;line-height:1.4}
    .items-row{display:flex;flex-wrap:wrap;gap:8px;padding:0 14px 18px}
    .item-pill{background:#fff6db;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:700}
    .badge-offer{position:absolute;top:12px;left:12px;background:var(--accent);color:white;padding:8px 12px;border-radius:8px;font-weight:800;font-size:13px}
    .search-bar{max-width:860px;margin:20px auto 10px;position:relative}
    .search-bar input{width:100%;padding:14px 50px 14px 18px;border-radius:999px;border:1px solid #ddd;background:white;font-size:15px}
    .search-bar input:focus{outline:none;box-shadow:0 0 0 3px rgba(255,215,0,0.3)}
    .search-bar .icon{position:absolute;right:16px;top:50%;transform:translateY(-50%);color:var(--accent)}
    @media (max-width:640px){
      header{padding:12px}
      .brand{font-size:18px}
      .card img{height:140px}
    }
  </style>
</head>
<body>

  <div class="floating-icons" aria-hidden="true">
    <svg class="float-svg float-1" viewBox="0 0 64 64"><g fill="none"><path d="M32 2C18 2 6.5 10 2 22c5 10 20 28 30 40 10-12 25-30 30-40C57.5 10 46 2 32 2z" fill="#FFEAA7"/><circle cx="26" cy="34" r="3" fill="#FF8A65"/><circle cx="36" cy="28" r="2.5" fill="#FF8A65"/></g></svg>
    <svg class="float-svg float-2" viewBox="0 0 64 64"><rect x="4" y="22" width="56" height="20" rx="10" fill="#FFD54A"/><path d="M6 26h52v8H6z" fill="#D84315"/></svg>
    <svg class="float-svg float-3" viewBox="0 0 64 64"><path d="M32 10c7 0 12 6 12 11 0 4-3 7-6 9-1 1-6 3-6 3s-5-2-6-3c-3-2-6-5-6-9 0-5 5-11 12-11z" fill="#FFF3E0"/><path d="M28 36l-6 14c.8.6 1.9 1 3 1h8c1.1 0 2.2-.4 3-1l-6-14z" fill="#FFB74D"/></svg>
    <svg class="float-svg float-4" viewBox="0 0 64 64"><path d="M12 16h28v22H12z" fill="#FFF8E1"/><path d="M40 22h6a8 8 0 110 16h-6z" fill="#FFD54A"/></svg>
  </div>

  <header>
    <button id="navBtn" class="nav-btn" aria-label="Menu">Menu Icon</button>
    <div class="brand">Chat<span style="color:var(--accent)">Point</span></div>
    <div class="header-right">
      <button class="cart-btn" onclick="location.href='cart.html'">Cart</button>
    </div>
  </header>

  <aside id="sidebar" class="sidebar">
    <div class="profile-section" id="profileSection">Welcome</div>
    <nav style="margin-top:20px">
      <a href="orders.html">My Orders</a>
      <a href="tel:8088975913">Contact: 8088975913</a>
      <a href="#" id="logout" style="display:none;color:var(--accent)">Logout</a>
    </nav>
    <div style="margin-top:auto;padding-top:20px;font-size:13px;color:var(--muted)">Â© 2025 Chat Point</div>
  </aside>
  <div id="overlay" class="overlay"></div>

  <main>
    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="Search shops or food..." oninput="searchShops()">
      <i class="fas fa-search icon"></i>
    </div>

    <section class="grid" id="grid"></section>
  </main>

  <script>
    const API = ""; // same domain

    async function loadShops() {
      try {
        const res = await fetch(API + "/api/shops");
        const json = await res.json();
        if (json.success && json.shops.length > 0) {
          renderShops(json.shops);
        } else {
          // Fallback to your old beautiful shops if nothing in DB
          renderShops([
            { shopName: "Chat Point", imageUrl: ["images/dolphin.png"], rating: 4.9, items: [{name:"Zinger Burger"},{name:"Peri Peri Fries"},{name:"Cold Coffee"},{name:"Oreo Shake"}] },
            { shopName: "Sangambar Udpi-Hotel", imageUrl: ["images/sangambar-udpi-hotel.png"], rating: 4.6, items: [{name:"Masala Dosa"},{name:"Idli Vada"}] },
            { shopName: "Nandi Grand Hotels", imageUrl: ["images/nandini-grand-hotels.png"], rating: 4.7, items: [{name:"Ghee Roast"}] },
            { shopName: "Pizza spot", imageUrl: ["images/Pizza-Spot-Special.jpg"], rating: 4.5, items: [{name:"Margherita"}] },
            { shopName: "Fly Pizza", imageUrl: ["https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=500"], rating: 4.6, items: [{name:"Paneer Tikka"}] },
            { shopName: "Mister Chef", imageUrl: ["mister-chef.png"], rating: 4.7, items: [{name:"Classic Burger"}] },
            { shopName: "Dolphin Hotel", imageUrl: ["images/Tandoori-Paneer.jpg"], rating: 4.5, items: [{name:"Veg Sandwich"}] },
            { shopName: "Hassanmba iyyangar bakery", imageUrl: ["images/bekary.png"], rating: 4.5, items: [{name:"Honey Cake"}] }
          ]);
        }
      } catch (e) {
        console.log("Offline mode - using default shops");
        renderShops([
          { shopName: "Chat Point", imageUrl: ["images/dolphin.png"], rating: 4.9, items: [{name:"Zinger Burger"}] },
          // ... same as above
        ]);
      }
    }

    function renderShops(shops) {
      const grid = document.getElementById("grid");
      grid.innerHTML = "";
      shops.forEach(shop => {
        const cardWrap = document.createElement("div");
        cardWrap.className = "card-wrap";

        const card = document.createElement("div");
        card.className = "card";
        card.onclick = () => {
          localStorage.setItem("selectedShop", JSON.stringify(shop));
          location.href = `items.html?shop=${encodeURIComponent(shop.shopName)}`;
        };

        const img = document.createElement("img");
        img.src = shop.imageUrl?.[0] || "https://via.placeholder.com/400x260/FFD700/333?text=No+Image";
        img.alt = shop.shopName;
        img.onerror = () => { img.src = "https://via.placeholder.com/400x260/FFD700/333?text=" + encodeURIComponent(shop.shopName); };

        const badge = document.createElement("div");
        badge.className = "badge-offer";
        badge.textContent = shop.rating >= 4.7 ? "TOP RATED" : "NEW";

        const info = document.createElement("div");
        info.className = "info";
        info.innerHTML = `<div class="shop-name">${shop.shopName}</div><div class="rating"><i class="fas fa-star"></i> ${shop.rating || "4.6"}</div>`;

        const desc = document.createElement("div");
        desc.className = "desc";
        desc.textContent = shop.desc || "Delicious food & fast delivery";

        const itemsRow = document.createElement("div");
        itemsRow.className = "items-row";
        (shop.items || []).slice(0,4).forEach(item => {
          const pill = document.createElement("div");
          pill.className = "item-pill";
          pill.textContent = item.name;
          itemsRow.appendChild(pill);
        });

        card.append(img, info, desc, itemsRow);
        if (Math.random() > 0.3) cardWrap.appendChild(badge);
        cardWrap.appendChild(card);
        grid.appendChild(cardWrap);
      });
    }

    function searchShops() {
      const term = document.getElementById("searchInput").value.toLowerCase();
      document.querySelectorAll(".card").forEach(card => {
        const name = card.querySelector(".shop-name").textContent.toLowerCase();
        card.parentElement.style.display = name.includes(term) ? "" : "none";
      });
    }

    // Sidebar & Profile
    document.getElementById("navBtn").onclick = () => {
      document.getElementById("sidebar").classList.add("active");
      document.getElementById("overlay").classList.add("active");
    };
    document.getElementById("overlay").onclick = () => {
      document.getElementById("sidebar").classList.remove("active");
      document.getElementById("overlay").classList.remove("active");
    };

    function loadProfile() {
      const user = JSON.parse(localStorage.getItem("chatpoint_user") || "null");
      const profile = document.getElementById("profileSection");
      const logout = document.getElementById("logout");
      if (user) {
        profile.innerHTML = `<div style="display:flex;gap:12px;align-items:center"><div class="avatar"><i class="fas fa-user"></i></div><div><div style="font-weight:800">${user.name}</div><div style="font-size:13px;color:var(--muted)">${user.phone}</div></div></div>`;
        logout.style.display = "block";
        logout.onclick = () => { localStorage.removeItem("chatpoint_user"); location.reload(); };
      }
    }

    // Load everything
    loadShops();
    loadProfile();
  </script>
</body>
</html>
