<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grocery Items</title>
    <style>
        body { font-family: Arial, sans-serif; background:#f8f8f8; margin:0; padding:0; }
        .header { position:sticky; top:0; background:white; padding:15px; box-shadow:0 2px 10px rgba(0,0,0,0.1); display:flex; align-items:center; gap:15px; z-index:10; }
        .back { font-size:28px; cursor:pointer; color:#4CAF50; }
        .title { font-size:20px; font-weight:bold; flex:1; }
        .cart-icon { font-size:24px; position:relative; cursor:pointer; }
        .cart-count { position:absolute; top:-8px; right:-8px; background:#ff4444; color:white; font-size:12px; width:20px; height:20px; border-radius:50%; display:flex; align-items:center; justify-content:center; }
        .grid { display:grid; grid-template-columns:repeat(2,1fr); gap:15px; padding:20px; padding-bottom:100px; }
        .item { background:white; border-radius:12px; overflow:hidden; box-shadow:0 4px 10px rgba(0,0,0,0.1); position:relative; }
        .item img { width:100%; height:140px; object-fit:cover; }
        .info { padding:12px; }
        .name { font-size:14px; font-weight:600; margin-bottom:5px; }
        .price { font-size:16px; color:#4CAF50; font-weight:bold; }
        .add-btn { position:absolute; bottom:8px; right:8px; background:#4CAF50; color:white; border:none; width:40px; height:40px; border-radius:50%; font-size:20px; cursor:pointer; box-shadow:0 4px 10px rgba(76,175,80,0.3); }
    </style>
</head>
<body>
    <div class="header">
        <div class="back" onclick="history.back()">‚Üê</div>
        <div class="title" id="categoryName">Loading...</div>
        <div class="cart-icon" onclick="window.location='gcart.html'">
            üõí <span class="cart-count" id="cartCount">0</span>
        </div>
    </div>
    <div class="grid" id="itemsGrid"></div>

    <script>
        let cart = JSON.parse(localStorage.getItem('cart') || '[]');

        async function loadItems() {
            const category = localStorage.getItem('selectedCategory') || 'Fruits & Vegetables';
            document.getElementById('categoryName').textContent = category;

            const res = await fetch(`/api/items/${encodeURIComponent(category)}`);
            const data = await res.json();

            const items = data.success ? data.items : [];
            const grid = document.getElementById('itemsGrid');
            grid.innerHTML = items.map((item, i) => `
                <div class="item">
                    <img src="${item.imageUrl}" alt="${item.name}" loading="lazy" onerror="this.src='https://via.placeholder.com/300x140?text=No+Image'">
                    <div class="info">
                        <div class="name">${item.name}</div>
                        <div class="price">‚Çπ${item.price}</div>
                    </div>
                    <button class="add-btn" onclick="addToCart('${item._id}', '${item.name}', ${item.price}, '${item.imageUrl}')">+</button>
                </div>
            `).join('');

            updateCartCount();
        }

        function addToCart(id, name, price, img) {
            const existing = cart.find(c => c.id === id);
            if (existing) existing.qty++;
            else cart.push({ id, name, price, img, qty: 1 });
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
        }

        function updateCartCount() {
            const total = cart.reduce((sum, item) => sum + item.qty, 0);
            document.getElementById('cartCount').textContent = total || 0;
        }

        window.onload = loadItems;
    </script>
</body>
</html>
