<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Items | Chat Point</title>

  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <style>
    :root {
      --bg: #0f0f14;
      --card: rgba(18, 20, 28, 0.75);
      --muted: #9fb3ff;
      --text: #e6eeff;
      --accent: #59FF94;        /* lime-green accent */
      --accent-strong: #32E06A;
      --glow: rgba(89,255,148,0.06);
      --radius: 16px;
      --cart-height: 78px;
      --max-width: 1100px;
      --transition: 220ms cubic-bezier(.2,.9,.3,1);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html,body { height: 100%; }
    body {
      font-family: 'Outfit', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(800px 400px at 10% 80%, rgba(89,255,148,0.02), transparent 8%),
                  radial-gradient(700px 300px at 85% 20%, rgba(100,200,255,0.015), transparent 8%),
                  var(--bg);
      color: var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding-bottom: var(--cart-height);
      overflow-x: hidden;
    }

    /* --- Animated abstract SVGs (type 4: random mixed abstract icons) --- */
    .svg-deco {
      position: fixed;
      pointer-events: none;
      z-index: 0;
      opacity: 0.22;
      filter: drop-shadow(0 18px 40px rgba(0,0,0,0.6));
      transform-origin: center;
      will-change: transform, opacity;
      mix-blend-mode: screen;
    }
    @keyframes floatSlow {
      0% { transform: translateY(30vh) rotate(0deg) scale(.95); opacity:.20; }
      50% { transform: translateY(-10vh) rotate(180deg) scale(1.04); opacity:.32; }
      100% { transform: translateY(30vh) rotate(360deg) scale(.95); opacity:.20; }
    }
    .svg-deco.d1 { left: 6%; width: 110px; animation: floatSlow 28s linear infinite; }
    .svg-deco.d2 { left: 24%; width: 84px; animation: floatSlow 22s linear infinite; animation-delay: 3s; opacity:.18 }
    .svg-deco.d3 { right: 10%; width: 140px; animation: floatSlow 30s linear infinite; animation-delay: 6s; opacity:.16 }
    .svg-deco.d4 { left: 68%; width: 98px; animation: floatSlow 24s linear infinite; animation-delay: 2s; opacity:.20 }
    .svg-deco.d5 { right: 30%; width: 74px; animation: floatSlow 26s linear infinite; animation-delay: 8s; opacity:.22 }

    /* --- Header --- */
    header {
      position: sticky;
      top: 0;
      z-index: 40;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      padding:14px 18px;
      width: 100%;
      max-width: var(--max-width);
      margin: 10px auto 0;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.004));
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.03);
      backdrop-filter: blur(6px);
      box-shadow: 0 12px 30px rgba(0,0,0,0.6);
    }
    .brand { display:flex; align-items:center; gap:12px; }
    .back-btn {
      width:44px;height:44px;border-radius:10px;display:grid;place-items:center;
      background: rgba(255,255,255,0.02); color: var(--accent);
      font-size:18px; cursor:pointer; border:1px solid rgba(255,255,255,0.03);
      transition: all var(--transition);
    }
    .back-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 22px rgba(89,255,148,0.06); color: #000; background: linear-gradient(90deg,var(--accent),var(--accent-strong)); }
    .brand .title { font-weight:800; font-size:22px; color:var(--text); }
    .brand .title .chat { background: linear-gradient(90deg, #fff, var(--accent)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }

    .shop-name { font-weight:700; color:var(--accent); font-size:15px; text-align:right; }

    /* --- Main layout --- */
    main { max-width: var(--max-width); margin: 18px auto; padding: 18px; position:relative; z-index:5; }
    .login-banner {
      background: linear-gradient(180deg, rgba(89,255,148,0.03), rgba(255,255,255,0.01));
      border:1px solid rgba(89,255,148,0.08);
      color:var(--accent);
      padding:10px 12px;
      border-radius:12px;
      margin-bottom:18px;
      font-weight:700;
      text-align:center;
    }

    .items-grid {
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap:18px;
      align-items:start;
    }

    .item-card {
      background: var(--card);
      border-radius: var(--radius);
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.03);
      transition: transform var(--transition), box-shadow var(--transition);
      display:flex;
      flex-direction:column;
      min-height: 100%;
    }
    .item-card:hover { transform: translateY(-8px); box-shadow: 0 20px 50px rgba(0,0,0,0.6), 0 0 30px var(--glow); border-color: rgba(89,255,148,0.07); }

    .item-img {
      width:100%; height:190px; object-fit:cover; background:#12121b; display:block;
    }

    .item-info {
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:8px;
      flex:1 1 auto;
    }
    .item-name { font-weight:800; font-size:17px; color:var(--text); }
    .item-desc { color: #a8b8ff; font-size:13px; }
    .item-price { font-weight:900; font-size:18px; color:var(--accent); }

    .quantity {
      margin-top:10px;
      display:flex; gap:10px; align-items:center;
      background: rgba(255,255,255,0.02); padding:8px 10px; border-radius:999px;
      justify-content:center;
    }
    .qbtn {
      width:36px;height:36px;border-radius:50%;border:none;font-weight:800;
      display:grid;place-items:center;cursor:pointer;background:rgba(255,255,255,0.02);
      color:var(--accent); transition: all var(--transition);
    }
    .qbtn:hover { transform: translateY(-3px); background: linear-gradient(90deg,var(--accent),var(--accent-strong)); color:#000; box-shadow: 0 8px 20px rgba(50,224,106,0.12); }
    .qty { min-width:30px;text-align:center;font-weight:900;color:#bfffd6; }

    /* --- Cart bar --- */
    .cart-bar {
      position: fixed;
      left: 12px; right: 12px; bottom: 12px;
      height: var(--cart-height);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.003));
      border-radius: 14px;
      padding: 10px 18px;
      display: none;
      align-items:center;
      justify-content:space-between;
      border:1px solid rgba(255,255,255,0.03);
      backdrop-filter: blur(8px);
      z-index: 60;
      max-width: calc(var(--max-width) + 36px);
      margin: 0 auto;
      left: 50%;
      transform: translateX(-50%);
    }
    .cart-info .main { font-weight:900; font-size:16px; color:var(--text); }
    .cart-info .sub { font-size:12px; color:#b9c7d6; margin-top:3px; }
    .checkout-btn {
      background: linear-gradient(90deg, var(--accent), var(--accent-strong));
      color:#021204; font-weight:900; padding:10px 16px; border-radius:10px; border:none; cursor:pointer;
      box-shadow: 0 10px 30px rgba(50,224,106,0.14);
      transition: transform var(--transition), box-shadow var(--transition);
    }
    .checkout-btn:hover { transform: translateY(-3px); box-shadow: 0 18px 44px rgba(50,224,106,0.22); }

    /* --- Utilities --- */
    a { color: var(--accent); text-decoration: none; }
    .center { text-align:center; color:#9aaefc; padding:34px; }

    /* --- Responsive --- */
    @media (max-width: 980px) {
      .items-grid { grid-template-columns: 1fr 1fr; gap:12px; }
      header { margin: 10px 12px; padding:12px; border-radius:10px; }
      .cart-bar { left: 12px; right: 12px; max-width: none; transform:none; }
    }
    @media (max-width: 620px) {
      .items-grid { grid-template-columns: 1fr; gap:12px; }
      .item-img { height:160px; }
      header { padding:10px; flex-direction:row; gap:8px; }
    }
  </style>
</head>
<body>

  <!-- SVG Decorations (mixed abstract icons, soft floating) -->
  <svg class="svg-deco d1" viewBox="0 0 48 48" aria-hidden>
    <defs>
      <linearGradient id="g1" x1="0" x2="1">
        <stop offset="0" stop-color="#59FF94"/>
        <stop offset="1" stop-color="#32E06A"/>
      </linearGradient>
    </defs>
    <path d="M6 10c6-6 30-6 36 0v28c-6 6-30 6-36 0z" fill="url(#g1)" opacity="0.9"/>
  </svg>

  <svg class="svg-deco d2" viewBox="0 0 48 48" aria-hidden>
    <defs><linearGradient id="g2"><stop offset="0" stop-color="#59FF94"/><stop offset="1" stop-color="#9FEFBF"/></linearGradient></defs>
    <circle cx="24" cy="22" r="16" fill="url(#g2)" opacity="0.85"/>
  </svg>

  <svg class="svg-deco d3" viewBox="0 0 48 48" aria-hidden>
    <defs><linearGradient id="g3"><stop offset="0" stop-color="#6FEFCD"/><stop offset="1" stop-color="#2ED07E"/></linearGradient></defs>
    <rect x="6" y="8" width="36" height="32" rx="8" fill="url(#g3)" opacity="0.88"/>
  </svg>

  <svg class="svg-deco d4" viewBox="0 0 48 48" aria-hidden>
    <defs><linearGradient id="g4"><stop offset="0" stop-color="#59FF94"/><stop offset="1" stop-color="#32E06A"/></linearGradient></defs>
    <path d="M8 36C20 28 28 28 40 36V12C28 20 20 20 8 12z" fill="url(#g4)" opacity="0.82"/>
  </svg>

  <svg class="svg-deco d5" viewBox="0 0 48 48" aria-hidden>
    <defs><linearGradient id="g5"><stop offset="0" stop-color="#9FEFBF"/><stop offset="1" stop-color="#32E06A"/></linearGradient></defs>
    <path d="M24 6c8 0 14 6 14 14s-6 14-14 14S10 28 10 20 16 6 24 6z" fill="url(#g5)" opacity="0.76"/>
  </svg>

  <!-- Header -->
  <header>
    <div class="brand" style="flex:1">
      <button class="back-btn" id="backBtn" title="Back" aria-label="Back">
        <i class="fas fa-arrow-left"></i>
      </button>
      <div style="margin-left:8px">
        <div class="title"><span class="chat">Chat</span>Point</div>
        <div style="font-size:12px;color:#9fb3ff">Sindagi • Food Delivery</div>
      </div>
    </div>

    <div style="flex:0 0 auto; text-align:right">
      <div class="shop-name" id="shopName">Loading...</div>
    </div>
  </header>

  <main>
    <div id="loginBanner" class="login-banner" style="display:none;">
      Please <a href="login.html">login</a> to add items to cart.
    </div>

    <div class="items-grid" id="itemsGrid"></div>
  </main>

  <div class="cart-bar" id="cartBar" role="button" aria-label="Open cart">
    <div class="cart-info">
      <div class="main" id="cartText">0 items · ₹0</div>
      <div class="sub">Tap to view cart</div>
    </div>
    <button class="checkout-btn" id="checkoutBtn">Checkout</button>
  </div>

  <script>
    // -------------- USER LOGIN CHECK --------------
    const USER_KEY = "chatpoint_user";
    const rawUser = localStorage.getItem(USER_KEY);
    let user = null;
    try { user = JSON.parse(rawUser); } catch(e) { user = null; }
    const isLoggedIn = user && user._id;

    if (!isLoggedIn) {
      document.getElementById("loginBanner").style.display = "block";
    }

    // -------------- SHOP DATA (kept as original, unchanged) --------------
    const shopData = {
      "7th Wonder (Cake)": [
        { name: "Chocolate Truffle Cake", price: 380 },
        { name: "Red Velvet Cake", price: 400 },
        { name: "Black Forest", price: 350 }
      ],
      "Sangambar Udpi-Hotel": [
        { name: "Tomato Soup", price: 105 },
        { name: "Sweet Corn Soup", price: 95 },
        { name: "Veg Clear Soup", price: 95 },
        { name: "Cream Mushroom Soup", price: 95 },
        { name: "Manchow Soup", price: 105 },
        { name: "Hot and Sour Soup", price: 105 },

        { name: "Papad", price: 85 },
        { name: "Gobi 65", price: 135 },
        { name: "Gobi Manchurian", price: 125 },
        { name: "Mushroom Manchurian", price: 185 },
        { name: "Paneer Manchurian", price: 205 },
        { name: "Paneer Chilli", price: 195 },
        { name: "Mushroom Chilli", price: 185 },
        { name: "Paneer Tikka", price: 205 },
        { name: "Veg Manchurian", price: 105 },

        { name: "Vada Pav (Plate)", price: 65 },
        { name: "Vada Pav (Single)", price: 45 },
        { name: "Pani Puri", price: 55 },
        { name: "Masala Puri", price: 75 },
        { name: "Belpuri", price: 65 },
        { name: "Sevpuri", price: 75 },
        { name: "Dahi Puri", price: 85 },
        { name: "Single Samosa", price: 45 },
        { name: "Samosa Masala", price: 65 },
        { name: "Pav Bhaji", price: 85 },
        { name: "Extra Pav", price: 20 },
        { name: "Finger Chips", price: 125 },

        { name: "Idli 2 Pieces", price: 65 },
        { name: "Vada (Single)", price: 55 },
        { name: "Curd Vada", price: 85 },
        { name: "Khara Bath", price: 55 },
        { name: "Kesari Bath", price: 65 },
        { name: "Chow Chow Bath", price: 85 },
        { name: "Rice Bath", price: 75 },
        { name: "Set Dosa", price: 95 },
        { name: "Idli Vada ", price: 85 },
        { name: "Idli Vada ", price: 75 },
        { name: "Mosar Avalakki", price: 75 },
        { name: "Buns", price: 55 },
        { name: "Plain Dosa", price: 85 },
        { name: "Masala Dosa", price: 95 },
        { name: "Onion Utthappa", price: 95 },
        { name: "Rava Dosa", price: 105 },
        { name: "Tomato Omelette", price: 105 },
        { name: "Paper Masala Dosa", price: 135 },
        { name: "Benne Dosa", price: 95 },
        { name: "Benne Masala Dosa", price: 115 },
        { name: "Mysore Masala Dosa", price: 115 },
        { name: "Paneer Masala Dosa", price: 115 }
      ],
      "Nandini Grand Hotels": [
        { name: "Shira", price: 35 },
        { name: "Set D20 Dosa", price: 65 },
        { name: "Poori", price: 70 },
        { name: "Full Meals", price: 95 },
        { name: "Onion Dosa", price: 75 },
        { name: "Utappa", price: 75 },
        { name: "Mysore Bonda", price: 75 },
        { name: "Mangalore Buns", price: 75 },
        { name: "Paneer Dosa", price: 80 },
        { name: "Cheese Dosa", price: 75 },
        { name: "Chou Chou Bath", price: 70 }
      ],
      "Pizza spot": [
        { name: "Nuggets", price: 85 },
        { name: "French Fries", price: 95 },
        { name: "Masala Fries", price: 105 },
        { name: "Smiley Fries", price: 105 },
        { name: "Pizza Spot Special", price: 165 },

        { name: "Burger Classic", price: 85 },
        { name: "Aloo Tikki Burger", price: 85 },
        { name: "Paneer Burger", price: 95 },
        { name: "Double Decker Burger", price: 125 },
        { name: "Pizza Spot Special Burger", price: 165 },

        { name: "Margherita", price: 154 },
        { name: "Veggie", price: 174 },
        { name: "Veggie Lover", price: 204 },
        { name: "Sweet Corn", price: 204 },
        { name: "Baby Corn", price: 224 },
        { name: "Tandoori Paneer", price: 235 },

        { name: "Steam Momos", price: 75 },
        { name: "Fried Momos", price: 85 },
        { name: "Kurkure Momos", price: 105 },

        { name: "Veg Sandwich", price: 75 },
        { name: "Cheese Sandwich", price: 85 },
        { name: "Sweet Corn Sandwich", price: 85 },
        { name: "Masala Sandwich", price: 85 },
        { name: "Paneer Tandoori Sandwich", price: 95 },
        { name: "Club Sandwich", price: 125 },
        { name: "Pizza Spot Special Sandwich", price: 145 },

        { name: "Pav Bhaji", price: 65 },
        { name: "Cheese Pav Bhaji", price: 85 },

        { name: "Veg Roll", price: 75 },
        { name: "Sweet Corn Roll", price: 95 },
        { name: "Paneer Roll", price: 105 }
      ],
      "Fly Pizza": [
        { name: "Delight Burger Veg", price: 99 },
        { name: "BBQ Burger Veg", price: 109 },
        { name: "Tandoori Burger Veg", price: 119 },
        { name: "Makhani Burger Veg", price: 119 },
        { name: "Paneer Tikka Burger", price: 159 },

        { name: "Chicken Delight Burger", price: 119 },
        { name: "BBQ Chicken Burger", price: 129 },
        { name: "Tandoori Chicken Burger", price: 149 },
        { name: "Chicken Makhani Burger", price: 159 },
        { name: "Chicken Tikka Burger", price: 169 },

        { name: "Delight Masala Sandwich (Veg)", price: 109 },
        { name: "Tandoori Paneer Sandwich", price: 119 },
        { name: "Sauth Grilled Sandwich (Veg)", price: 119 },
        { name: "Spacial Paneer Sandwich", price: 139 },

        { name: "Delight Chicken Masala Sandwich", price: 129 },
        { name: "Tandoori Chicken Sandwich", price: 149 },
        { name: "Sauth Grilled Chicken Sandwich", price: 149 },
        { name: "Spacial Chicken Sandwich", price: 169 },
        { name: "Creamy Alfredo Pasta Veg", price: 199 },
        { name: "Red Sauce Pasta Veg", price: 209 },
        { name: "White Sauce Pasta Veg", price: 209 },
        { name: "Peri Peri Pasta Veg", price: 249 },

        { name: "Creamy Chicken Alfredo Pasta", price: 209 },
        { name: "Red Sauce Chicken Pasta", price: 229 },
        { name: "White Sauce Chicken Pasta", price: 229 },
        { name: "Peri Peri Chicken Pasta", price: 269 }
      ],
      "Mister Chef": [
        { name: "Classic Burger", price: 120 },
        { name: "French Fries", price: 99 }
      ],
      "Bekary": [
        { name: "Veg Pizza", price: 170 },
        { name: "Margherita Pizza", price: 160 },
        { name: "Paneer Pizza", price: 220 },
        { name: "Golden Corn Pizza", price: 229 },
        { name: "Sweet Corn Pizza", price: 220 },
        { name: "Baby Corn Pizza", price: 220 },

        { name: "Classic Veg Burger", price: 80 },
        { name: "Cheese Burger", price: 90 },
        { name: "Paneer Tandoori Burger", price: 90 },
        { name: "Classic Burger", price: 140 },

        { name: "Cheese Sandwich", price: 80 },
        { name: "Veg Sandwich", price: 70 },
        { name: "Veg Roll", price: 50 },
        { name: "Egg Roll", price: 50 },
        { name: "Cheese Roll", price: 55 }
      ],
      "Dolphin": [
        { name: "Chicken Tandoori", price: 280 }
      ]
    };

    // -------------- GET SHOP FROM URL --------------
    const urlParams = new URLSearchParams(window.location.search);
    const shopName = decodeURIComponent(urlParams.get("shop") || "");
    const shopItems = shopData[shopName] || [];

    // -------------- DOM ELEMENTS --------------
    const shopNameEl = document.getElementById("shopName");
    const itemsGrid = document.getElementById("itemsGrid");
    const cartBar = document.getElementById("cartBar");
    const cartText = document.getElementById("cartText");
    const checkoutBtn = document.getElementById("checkoutBtn");
    const backBtn = document.getElementById("backBtn");

    // -------------- CART LOGIC --------------
    let cart = {};
    try { cart = JSON.parse(localStorage.getItem("chatpoint_cart")) || {}; } catch(e) { cart = {}; }

    function saveCart() {
      localStorage.setItem("chatpoint_cart", JSON.stringify(cart));
      updateCartBar();
    }

    function updateCartBar() {
      let totalItems = 0, totalPrice = 0;
      for (const shop in cart) {
        for (const itemName in cart[shop]) {
          const entry = cart[shop][itemName];
          totalItems += entry.qty;
          totalPrice += entry.qty * entry.price;
        }
      }
      cartText.textContent = `${totalItems} items · ₹${totalPrice}`;
      cartBar.style.display = totalItems > 0 ? "flex" : "none";
    }

    function changeQty(shop, itemName, price, delta) {
      if (!isLoggedIn) { alert("Please login to add items to cart."); return; }
      if (!cart[shop]) cart[shop] = {};
      if (!cart[shop][itemName]) cart[shop][itemName] = { qty: 0, price };
      cart[shop][itemName].qty = Math.max(0, cart[shop][itemName].qty + delta);
      if (cart[shop][itemName].qty === 0) delete cart[shop][itemName];
      if (Object.keys(cart[shop] || {}).length === 0) delete cart[shop];
      saveCart();
      renderItems(); // re-render to update visible quantities
    }

    function openCartPage() {
      if (!isLoggedIn) { alert("Please login to view cart."); window.location.href = "login.html"; return; }
      window.location.href = "cart.html";
    }

    // -------------- IMAGE PATH + FALLBACK --------------
    function getImagePath(itemName) {
      const slug = itemName
        .toLowerCase()
        .replace(/[^a-z0-9]+/g, '-')
        .replace(/^-+|-+$/g, '');
      return `images/${slug}.jpg`;
    }

    // -------------- RENDER ITEMS (clean, event-listeners) --------------
    function renderItems() {
      itemsGrid.innerHTML = "";
      if (shopItems.length === 0) {
        itemsGrid.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:#9aaeff;padding:40px;font-size:18px;">No items found for this shop.</div>';
        return;
      }

      shopItems.forEach((item, idx) => {
        const qty = (cart[shopName] && cart[shopName][item.name]) ? cart[shopName][item.name].qty : 0;
        const imgSrc = getImagePath(item.name);

        const card = document.createElement('article');
        card.className = 'item-card';

        // image
        const img = document.createElement('img');
        img.className = 'item-img';
        img.alt = item.name;
        img.loading = 'lazy';
        img.src = imgSrc;
        img.onerror = function() {
          this.onerror = null;
          this.src = `https://via.placeholder.com/600x380/12121b/ffffff?text=${encodeURIComponent(item.name)}`;
        };

        // info wrapper
        const info = document.createElement('div');
        info.className = 'item-info';

        const title = document.createElement('div');
        title.className = 'item-name';
        title.textContent = item.name;

        const desc = document.createElement('div');
        desc.className = 'item-desc';
        desc.textContent = "Fresh • Chef's Special";

        const price = document.createElement('div');
        price.className = 'item-price';
        price.textContent = `₹${item.price}`;

        info.appendChild(title);
        info.appendChild(desc);
        info.appendChild(price);

        // quantity / controls
        const controls = document.createElement('div');
        controls.className = 'quantity';

        if (isLoggedIn) {
          const btnMinus = document.createElement('button');
          btnMinus.className = 'qbtn';
          btnMinus.type = 'button';
          btnMinus.setAttribute('aria-label','Decrease quantity');
          btnMinus.innerHTML = '−';
          btnMinus.addEventListener('click', () => changeQty(shopName, item.name, item.price, -1));

          const qtyEl = document.createElement('div');
          qtyEl.className = 'qty';
          qtyEl.textContent = qty;

          const btnPlus = document.createElement('button');
          btnPlus.className = 'qbtn';
          btnPlus.type = 'button';
          btnPlus.setAttribute('aria-label','Increase quantity');
          btnPlus.innerHTML = '+';
          btnPlus.addEventListener('click', () => changeQty(shopName, item.name, item.price, +1));

          controls.appendChild(btnMinus);
          controls.appendChild(qtyEl);
          controls.appendChild(btnPlus);
        } else {
          const loginNote = document.createElement('div');
          loginNote.style.marginTop = '8px';
          loginNote.style.color = '#ffb18a';
          loginNote.style.fontSize = '13px';
          loginNote.style.textAlign = 'center';
          loginNote.textContent = 'Login to add';
          controls.appendChild(loginNote);
        }

        info.appendChild(controls);

        card.appendChild(img);
        card.appendChild(info);
        itemsGrid.appendChild(card);
      });
    }

    // -------------- INIT / UI WIRING --------------
    // set header shop name and render
    if (shopName && shopData[shopName]) {
      shopNameEl.textContent = shopName;
      renderItems();
      updateCartBar();
    } else {
      shopNameEl.textContent = "Shop Not Found";
      itemsGrid.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:#ff8a8a;padding:40px;">Invalid shop. <a href="index.html">Go back</a></div>';
    }

    // cart bar click
    cartBar.addEventListener('click', openCartPage);
    // checkout button stops propagation and opens cart
    checkoutBtn.addEventListener('click', (e) => { e.stopPropagation(); openCartPage(); });

    // back button
    backBtn.addEventListener('click', () => history.back());

    // initial update
    updateCartBar();

    // Accessibility: keyboard support for cart open
    cartBar.tabIndex = 0;
    cartBar.addEventListener('keypress', (e) => { if (e.key === 'Enter' || e.key === ' ') openCartPage(); });
  </script>
</body>
</html>
