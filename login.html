<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ChatPoint â€” Login / Signup</title>
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    :root {
      --bg: #3a3337;
      --card: #d9e0ae;
      --text: #1a1a1a;
      --muted: #666666;
      --primary: #128e7d;
      --primary-light: #e9ecec;
      --radius: 18px;
      --shadow: 0 16px 48px rgba(0,0,0,0.35);
      --transition: all 280ms cubic-bezier(0.2, 0.8, 0.2, 1);
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Outfit', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100dvh;
      display: grid;
      place-items: center;
      padding: 16px;
      background-image:
        radial-gradient(circle at 20% 80%, rgba(226,55,68,0.08) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255,255,255,0.03) 0%, transparent 40%),
        repeating-linear-gradient(45deg, transparent, transparent 20px, rgba(255,255,255,0.01) 20px, rgba(255,255,255,0.01) 40px);
      overflow-x: hidden;
    }
    .bg-canvas {
      position: fixed; inset: 0; z-index: 0; pointer-events: none; overflow: hidden;
    }
    .bg-canvas svg {
      position: absolute; opacity: 0.07; filter: drop-shadow(0 10px 30px rgba(0,0,0,0.5));
      mix-blend-mode: soft-light; will-change: transform;
    }
    .svg-1 { left: 8%; top: 15%; width: 120px; animation: float 28s infinite linear; }
    .svg-2 { right: 12%; top: 65%; width: 90px; animation: float 32s infinite linear reverse; animation-delay: 4s; }
    .svg-3 { left: 18%; top: 70%; width: 140px; animation: float 30s infinite linear; animation-delay: 8s; }
    .svg-4 { right: 15%; top: 10%; width: 80px; animation: float 26s infinite linear reverse; animation-delay: 2s; }
    @keyframes float {
      0%,100% { transform: translateY(20vh) rotate(0deg) scale(0.9); }
      50% { transform: translateY(-18vh) rotate(180deg) scale(1.1); }
    }
    .container { width: 100%; max-width: 420px; z-index: 10; position: relative; }
    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 36px 32px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(0,0,0,0.06);
      text-align: center;
    }
    .brand { display: flex; align-items: center; justify-content: center; gap: 6px; margin-bottom: 20px; }
    .brand span { font-size: 32px; font-weight: 900; color: var(--primary); }
    .lead { font-size: 22px; font-weight: 700; color: #222; margin-bottom: 24px; }
    .form-group { margin-bottom: 16px; text-align: left; }
    .input {
      width: 100%; padding: 16px 18px; border-radius: 12px;
      border: 1.5px solid #e0e0e0; background: #fafafa;
      font-size: 16px; color: var(--text); outline: none;
      transition: var(--transition);
    }
    .input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 4px var(--primary-light);
      background: white;
    }
    .btn {
      width: 100%; padding: 16px; margin-top: 12px;
      background: var(--primary); color: white;
      border: none; border-radius: 12px; font-weight: 800; font-size: 17px;
      cursor: pointer; text-transform: uppercase; letter-spacing: 0.5px;
      transition: var(--transition);
      box-shadow: 0 8px 24px rgba(226,55,68,0.4);
    }
    .btn:hover { background: #d32f3b; transform: translateY(-3px); }
    .toggle-text { margin-top: 20px; font-size: 14.5px; color: var(--muted); }
    .toggle-text a { color: var(--primary); font-weight: 700; text-decoration: none; }
    .toggle-text a:hover { color: #c6303c; text-decoration: underline; }
    #loadingOverlay {
      position: fixed; inset: 0; background: rgba(18,18,18,0.95);
      backdrop-filter: blur(8px); display: none; align-items: center; justify-content: center; z-index: 9999;
    }
    #loadingOverlay.active { display: flex; }
    .loader { width: 90%; max-width: 400px; text-align: center; color: white; }
    .progress-bar { height: 10px; background: rgba(255,255,255,0.15); border-radius: 10px; overflow: hidden; margin: 20px 0; }
    .progress-fill { height: 100%; width: 0%; background: var(--primary); border-radius: 10px; transition: width 0.4s ease; }

    /* Toast Styles (Now on TOP-RIGHT) */
    #toast-container {
      position: fixed;
      top: 30px;
      right: 30px;
      z-index: 10000;
      display: flex;
      flex-direction: column;
      gap: 12px;
      pointer-events: none;
    }
    .toast {
      min-width: 320px;
      max-width: 400px;
      padding: 16px 20px;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      display: flex;
      align-items: center;
      gap: 14px;
      color: white;
      font-weight: 600;
      opacity: 0;
      transform: translateY(-100px); /* Slide from top */
      transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
      pointer-events: all;
    }
    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }
    .toast i {
      font-size: 24px;
    }
    .toast .message {
      flex: 1;
    }
    .toast .close-btn {
      cursor: pointer;
      font-size: 20px;
      opacity: 0.7;
      transition: opacity 0.2s;
    }
    .toast .close-btn:hover { opacity: 1; }
    .toast.success { background: #2d8a3d; }
    .toast.error { background: #c42b2b; }
    .toast.offline { background: #b36b00; }

    @media (max-width: 480px) {
      .card { padding: 28px 24px; border-radius: 16px; }
      .brand span { font-size: 28px; }
      .lead { font-size: 20px; }
      #toast-container { top: 20px; right: 20px; left: 20px; }
      .toast { min-width: auto; }
    }
  </style>
</head>
<body>
  <div class="bg-canvas" aria-hidden="true">
    <svg class="svg-1" viewBox="0 0 64 64"><defs><linearGradient id="g1"><stop offset="0" stop-color="#e23744"/><stop offset="1" stop-color="#ff6b35"/></linearGradient></defs><path d="M32 6 L54 46 A26 26 0 0 1 10 46 Z" stroke="url(#g1)" stroke-width="3" fill="none"/><circle cx="26" cy="36" r="3" fill="#e23744"/><circle cx="36" cy="34" r="3" fill="#e23744"/></svg>
    <svg class="svg-2" viewBox="0 0 64 64"><defs><linearGradient id="g2"><stop offset="0" stop-color="#e23744"/><stop offset="1" stop-color="#ff6b35"/></linearGradient></defs><rect x="12" y="20" width="40" height="8" rx="4" stroke="url(#g2)" stroke-width="3" fill="none"/><rect x="12" y="34" width="40" height="8" rx="4" stroke="url(#g2)" stroke-width="3" fill="none"/></svg>
    <svg class="svg-3" viewBox="0 0 64 64"><defs><linearGradient id="g3"><stop offset="0" stop-color="#e23744"/><stop offset="1" stop-color="#ff6b35"/></linearGradient></defs><rect x="18" y="18" width="28" height="28" rx="6" stroke="url(#g3)" stroke-width="3" fill="none"/><path d="M24 18 Q32 6 40 18" stroke="url(#g3)" stroke-width="3" fill="none"/></svg>
    <svg class="svg-4" viewBox="0 0 64 64"><defs><linearGradient id="g4"><stop offset="0" stop-color="#e23744"/><stop offset="1" stop-color="#ff6b35"/></linearGradient></defs><rect x="20" y="16" width="24" height="10" rx="4" stroke="url(#g4)" stroke-width="2.8" fill="none"/><rect x="24" y="26" width="4" height="18" fill="#e23744"/><rect x="30" y="26" width="4" height="18" fill="#e23744"/><rect x="36" y="26" width="4" height="18" fill="#e23744"/></svg>
  </div>

  <div class="container">
    <div class="card">
      <div class="brand"><span>Chat</span><span>Point</span></div>
      <div id="loginForm">
        <div class="lead">Welcome back!</div>
        <div class="form-group"><input type="tel" id="loginPhone" class="input" placeholder="Phone number" maxlength="10" inputmode="numeric" /></div>
        <div class="form-group"><input type="password" id="loginPassword" class="input" placeholder="Password" /></div>
        <button class="btn" id="btnLogin">Login</button>
        <div class="toggle-text">New to ChatPoint? <a href="#" id="showSignup">Create account</a></div>
      </div>
      <div id="signupForm" style="display:none">
        <div class="lead">Join ChatPoint</div>
        <div class="form-group"><input type="text" id="signupName" class="input" placeholder="Full name" /></div>
        <div class="form-group"><input type="tel" id="signupPhone" class="input" placeholder="Phone number" maxlength="10" inputmode="numeric" /></div>
        <div class="form-group"><input type="password" id="signupPassword" class="input" placeholder="Create password" /></div>
        <button class="btn" id="btnSignup">Sign Up</button>
        <div class="toggle-text">Have an account? <a href="#" id="showLogin">Sign in</a></div>
      </div>
    </div>
  </div>

  <div id="loadingOverlay">
    <div class="loader">
      <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
      <div id="loaderText">Connecting...</div>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toast-container"></div>

  <script>
    const $ = id => document.getElementById(id);
    const loginForm = $('loginForm');
    const signupForm = $('signupForm');
    const loading = $('loadingOverlay');
    const progress = $('progressFill');
    const loaderText = $('loaderText');

    // Toggle forms
    $('showSignup').onclick = e => { e.preventDefault(); loginForm.style.display = 'none'; signupForm.style.display = 'block'; };
    $('showLogin').onclick = e => { e.preventDefault(); signupForm.style.display = 'none'; loginForm.style.display = 'block'; };

    // Loading overlay
    function showLoading() {
      loading.classList.add('active');
      let w = 10;
      const int = setInterval(() => { w = Math.min(w + 7, 94); progress.style.width = w + '%'; }, 300);
      let dots = 0;
      const textInt = setInterval(() => { loaderText.textContent = 'Connecting' + '.'.repeat((dots++ % 3) + 1); }, 500);
      return () => { clearInterval(int); clearInterval(textInt); };
    }
    function hideLoading() {
      progress.style.width = '100%';
      setTimeout(() => { loading.classList.remove('active'); progress.style.width = '0%'; }, 500);
    }

    // Sound Effects (verified URLs - should play post-click)
    const sounds = {
      success: 'https://assets.mixkit.co/sfx/preview/mixkit-bell-notification-933.mp3',
      error: 'https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-946.mp3',
      offline: 'https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3'
    };

    function playSound(type) {
      console.log(`Trying to play sound: ${type} from ${sounds[type]}`); // Debug log
      const audio = new Audio(sounds[type]);
      audio.volume = 0.4;
      audio.play().then(() => {
        console.log(`Sound played successfully: ${type}`);
      }).catch(err => {
        console.error(`Sound play failed: ${type} - Error: ${err.message}`);
      });
    }

    // Toast Notification Function
    function showToast(message, type = 'error', duration = 4500) {
      const container = $('toast-container');
      const toast = document.createElement('div');
      toast.classList.add('toast', type);

      let icon = 'fa-circle-exclamation';
      if (type === 'success') icon = 'fa-circle-check';
      else if (type === 'offline') icon = 'fa-wifi';

      toast.innerHTML = `
        <i class="fas ${icon}"></i>
        <div class="message">${message}</div>
        <span class="close-btn" onclick="this.parentElement.classList.remove('show'); setTimeout(()=>this.parentElement.remove(),400)">&times;</span>
      `;

      container.appendChild(toast);
      setTimeout(() => toast.classList.add('show'), 100);

      // Play sound
      if (type in sounds) playSound(type);

      if (duration > 0) {
        setTimeout(() => {
          toast.classList.remove('show');
          setTimeout(() => toast.remove(), 400);
        }, duration);
      }
    }

    // Phone validation
    const isValidPhone = p => /^\d{10}$/.test(p.trim());
    const API_BASE = '';

    // Signup Handler
    $('btnSignup').onclick = async () => {
      const name = $('signupName').value.trim();
      const phone = $('signupPhone').value.trim();
      const password = $('signupPassword').value;

      if (!name || !phone || !password) return showToast('Please fill all fields', 'error');
      if (!isValidPhone(phone)) return showToast('Enter a valid 10-digit phone number', 'error');

      const stop = showLoading();
      try {
        const res = await fetch(API_BASE + '/api/user/signup', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, phone, password })
        });
        const data = await res.json();

        if (!res.ok || !data.success) {
          if (!navigator.onLine) throw new Error('No internet connection');
          throw new Error(data.message || 'Signup failed');
        }

        showToast(`Account created successfully! Welcome ${name}`, 'success', 5000);
        setTimeout(() => location.href = 'index.html', 1500);
      } catch (err) {
        let msg = err.message || 'Something went wrong';
        let type = 'error';
        if (msg.toLowerCase().includes('internet') || msg.toLowerCase().includes('network')) {
          msg = 'No internet connection';
          type = 'offline';
        }
        showToast(msg, type);
      } finally {
        stop();
        hideLoading();
      }
    };

    // Login Handler
    $('btnLogin').onclick = async () => {
      const phone = $('loginPhone').value.trim();
      const password = $('loginPassword').value;

      if (!phone || !password) return showToast('Please fill all fields', 'error');
      if (!isValidPhone(phone)) return showToast('Enter a valid 10-digit phone number', 'error');

      const stop = showLoading();
      try {
        const res = await fetch(API_BASE + '/api/user/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ phone, password })
        });
        const data = await res.json();

        if (!res.ok || !data.success) {
          if (!navigator.onLine) throw new Error('No internet connection');
          throw new Error(data.message || 'Invalid credentials');
        }

        localStorage.setItem('chatpoint_user', JSON.stringify(data.user));
        showToast('Login successful! Welcome back', 'success', 4000);
        setTimeout(() => location.href = 'index.html', 1200);
      } catch (err) {
        let msg = err.message || 'Login failed';
        let type = 'error';
        if (msg.toLowerCase().includes('internet') || msg.toLowerCase().includes('network')) {
          msg = 'No internet connection';
          type = 'offline';
        } else if (msg.toLowerCase().includes('invalid') || msg.toLowerCase().includes('wrong')) {
          msg = 'Wrong phone number or password';
        }
        showToast(msg, type);
      } finally {
        stop();
        hideLoading();
      }
    };

    // Enter key support
    document.addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        if (signupForm.style.display !== 'none') {
          $('btnSignup').click();
        } else {
          $('btnLogin').click();
        }
      }
    });
  </script>
</body>
</html>
